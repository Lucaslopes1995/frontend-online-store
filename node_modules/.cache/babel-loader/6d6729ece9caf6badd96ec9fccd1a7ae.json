{"ast":null,"code":"var _jsxFileName = \"/home/lucas/Documentos/projetos/sd-021-b-project-frontend-online-store/src/pages/Home.js\";\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { getCategories, getProductsByNameAndCategory } from '../services/api';\nimport Header from '../components/Header';\nimport ModalCategories from '../components/ModalCategories';\n\nclass Home extends React.Component {\n  constructor() {\n    super();\n\n    this.ordenaProducts = products => {\n      const {\n        selectedFilter\n      } = this.state;\n      let aux;\n\n      if (selectedFilter === \"Maior Preço\") {\n        aux = -1;\n      } else if (selectedFilter === \"Menor Preço\") {\n        aux = 1;\n      } else {\n        return products;\n      }\n\n      const filtered = products.sort((a, b) => {\n        if (a.price < b.price) {\n          return -1 * aux;\n        }\n\n        if (a.price > b.price) {\n          return 1 * aux;\n        }\n\n        return 0;\n      });\n      return filtered;\n    };\n\n    this.handleButton = async e => {\n      e.preventDefault();\n      this.setState({\n        APIAwait: false\n      });\n      const {\n        inputValue,\n        selectedRadio\n      } = this.state;\n\n      if (inputValue !== '' || selectedRadio !== '') {\n        const productsByNameAndCategory = await getProductsByNameAndCategory(selectedRadio, inputValue);\n        const ordenProducts = this.ordenaProducts(productsByNameAndCategory);\n        this.setState({\n          filteredProducts: ordenProducts,\n          APIAwait: true\n        });\n      }\n    };\n\n    this.filterChange = e => {\n      const {\n        target: {\n          value\n        }\n      } = e;\n      this.setState({\n        selectedFilter: value\n      });\n      this.handleButton(e);\n    };\n\n    this.addToCart = product => {\n      const {\n        cartProducts\n      } = this.state;\n\n      if (cartProducts.find(el => el.id === product.id) === undefined) {\n        product.tamanho = 1;\n        this.setState({\n          cartProducts: [...cartProducts, product]\n        }, () => {\n          const {\n            cartProducts: Carrinho\n          } = this.state;\n          localStorage.setItem('productCart', JSON.stringify(Carrinho));\n        });\n      } else {\n        let index;\n        [...cartProducts].find((el, i) => {\n          if (el.id === product.id) {\n            index = i;\n            return true;\n          }\n\n          return false;\n        });\n        cartProducts[index].tamanho += 1;\n        this.setState({\n          cartProducts\n        }, () => {\n          const {\n            cartProducts: Carrinho\n          } = this.state;\n          localStorage.setItem('productCart', JSON.stringify(Carrinho));\n        });\n\n        if (product.available_quantity === product.tamanho - 1) {\n          product.tamanho = product.available_quantity;\n        }\n      }\n\n      this.setState(state => {\n        const {\n          cartProducts: cartAtualizado\n        } = state;\n        const total = cartAtualizado.reduce((ant, at) => ant + at.tamanho, 0);\n        return {\n          totalCart: total\n        };\n      });\n    };\n\n    this.state = {\n      inputValue: '',\n      listProducts: [],\n      listCategories: [],\n      selectedRadio: '',\n      filteredProducts: [],\n      cartProducts: [],\n      totalCart: 0,\n      APIAwait: false,\n      selectedFilter: '',\n      showCategories: false\n    };\n    this.handleChange = this.handleChange.bind(this);\n    this.handleChangeRadio = this.handleChangeRadio.bind(this);\n    this.setCategories = this.setCategories.bind(this);\n  }\n\n  componentDidMount() {\n    const getFavorites = JSON.parse(localStorage.getItem('productCart')) || [];\n    const total = getFavorites.reduce((ant, at) => ant + at.tamanho, 0);\n    const ajusteFav = getFavorites || [];\n    this.setState({\n      cartProducts: ajusteFav,\n      totalCart: total\n    });\n    this.setCategories();\n  }\n\n  handleChange(_ref) {\n    let {\n      target\n    } = _ref;\n    const {\n      name,\n      value\n    } = target;\n    this.setState(() => ({\n      [name]: value\n    }));\n  }\n\n  handleChangeRadio(e, el) {\n    this.setState({\n      selectedRadio: el.id,\n      showCategories: false\n    }, async () => {\n      this.handleButton(e);\n    });\n  }\n\n  async setCategories() {\n    /* console.log(await getProductsByNameAndCategory('Agro', '')); */\n    const categories = await getCategories();\n    this.setState({\n      listCategories: categories\n    });\n  }\n\n  render() {\n    const {\n      inputValue,\n      listProducts,\n      listCategories,\n      selectedRadio,\n      filteredProducts,\n      totalCart,\n      APIAwait,\n      selectedFilter,\n      showCategories\n    } = this.state;\n    const {\n      history\n    } = this.props;\n    const validListProducts = listProducts.length === 0;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"home\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Header, {\n      history: history,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 136,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"form\", {\n      onSubmit: this.handleButton,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 137,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      name: \"inputValue\",\n      type: \"text\",\n      value: inputValue,\n      onChange: this.handleChange,\n      \"data-testid\": \"query-input\",\n      autocomplete: \"off\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"button\", {\n      type: \"submmit\",\n      \"data-testid\": \"query-button\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 146,\n        columnNumber: 9\n      }\n    }, \"Buscar\")), /*#__PURE__*/React.createElement(\"select\", {\n      onChange: e => this.filterChange(e),\n      value: selectedFilter,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"option\", {\n      hidden: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 155,\n        columnNumber: 11\n      }\n    }, \"Ordenar por Pre\\xE7o\"), /*#__PURE__*/React.createElement(\"option\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 11\n      }\n    }, \"Maior Pre\\xE7o\"), /*#__PURE__*/React.createElement(\"option\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 11\n      }\n    }, \"Menor Pre\\xE7o\")), validListProducts && /*#__PURE__*/React.createElement(\"p\", {\n      \"data-testid\": \"home-initial-message\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 11\n      }\n    }, \"Digite algum termo de pesquisa ou escolha uma categoria.\"), /*#__PURE__*/React.createElement(\"button\", {\n      type: \"button\",\n      \"data-testid\": \"shopping-cart-button\",\n      onClick: () => history.push('/cart'),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 9\n      }\n    }, \"Carrinho\"), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 9\n      }\n    }, showCategories ? /*#__PURE__*/React.createElement(ModalCategories, {\n      listCategories: listCategories,\n      selectedRadio: selectedRadio,\n      handleChangeRadio: this.handleChangeRadio,\n      showCategories: () => this.setState({\n        showCategories: false\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 174,\n        columnNumber: 11\n      }\n    }) : /*#__PURE__*/React.createElement(\"p\", {\n      onClick: () => this.setState({\n        showCategories: false\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 179,\n        columnNumber: 11\n      }\n    }, \"Categorias\")), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 9\n      }\n    }, APIAwait && filteredProducts.map(cada => /*#__PURE__*/React.createElement(\"div\", {\n      \"data-testid\": \"product\",\n      key: cada.title,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 184,\n        columnNumber: 13\n      }\n    }, cada.shipping.free_shipping && /*#__PURE__*/React.createElement(\"p\", {\n      \"data-testid\": \"free-shipping\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 189,\n        columnNumber: 17\n      }\n    }, \"Frete Gr\\xE1tis\"), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 190,\n        columnNumber: 15\n      }\n    }, cada.title), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 191,\n        columnNumber: 15\n      }\n    }, \"R$ \" + cada.price), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 192,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      src: cada.thumbnail,\n      alt: cada.title,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 193,\n        columnNumber: 17\n      }\n    })), /*#__PURE__*/React.createElement(\"button\", {\n      type: \"button\",\n      onClick: () => history.push({\n        pathname: `/product/${cada.id}`,\n        state: cada\n      }),\n      \"data-testid\": \"product-detail-link\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 195,\n        columnNumber: 15\n      }\n    }, \"Detalhes\"), /*#__PURE__*/React.createElement(\"button\", {\n      type: \"button\",\n      onClick: () => this.addToCart(cada),\n      \"data-testid\": \"product-add-to-cart\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 15\n      }\n    }, \"Adicionar ao Carrinho\"))), /*#__PURE__*/React.createElement(\"h2\", {\n      \"data-testid\": \"shopping-cart-size\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 212,\n        columnNumber: 11\n      }\n    }, totalCart)));\n  }\n\n}\n\nHome.propTypes = {\n  history: PropTypes.instanceOf(Object).isRequired\n};\nexport default Home;","map":{"version":3,"sources":["/home/lucas/Documentos/projetos/sd-021-b-project-frontend-online-store/src/pages/Home.js"],"names":["React","PropTypes","getCategories","getProductsByNameAndCategory","Header","ModalCategories","Home","Component","constructor","ordenaProducts","products","selectedFilter","state","aux","filtered","sort","a","b","price","handleButton","e","preventDefault","setState","APIAwait","inputValue","selectedRadio","productsByNameAndCategory","ordenProducts","filteredProducts","filterChange","target","value","addToCart","product","cartProducts","find","el","id","undefined","tamanho","Carrinho","localStorage","setItem","JSON","stringify","index","i","available_quantity","cartAtualizado","total","reduce","ant","at","totalCart","listProducts","listCategories","showCategories","handleChange","bind","handleChangeRadio","setCategories","componentDidMount","getFavorites","parse","getItem","ajusteFav","name","categories","render","history","props","validListProducts","length","push","map","cada","title","shipping","free_shipping","thumbnail","pathname","propTypes","instanceOf","Object","isRequired"],"mappings":"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","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport { getCategories, getProductsByNameAndCategory } from '../services/api';\nimport Header from '../components/Header'\nimport ModalCategories from '../components/ModalCategories';\n\nclass Home extends React.Component {\n  constructor() {\n    super();\n    this.state = {\n      inputValue: '',\n      listProducts: [],\n      listCategories: [],\n      selectedRadio: '',\n      filteredProducts: [],\n      cartProducts: [],\n      totalCart: 0,\n      APIAwait:false,\n      selectedFilter:'',\n      showCategories:false\n    };\n    this.handleChange = this.handleChange.bind(this);\n    this.handleChangeRadio = this.handleChangeRadio.bind(this);\n    this.setCategories = this.setCategories.bind(this);\n  }\n\n  componentDidMount() {\n    const getFavorites = JSON.parse(localStorage.getItem('productCart')) || [];\n\n    const total = getFavorites.reduce((ant, at) => ant + at.tamanho, 0);\n\n    const ajusteFav = getFavorites || [];\n    this.setState({ cartProducts: ajusteFav, totalCart: total });\n\n    this.setCategories();\n  }\n\n  handleChange({ target }) {\n    const { name, value } = target;\n    this.setState(() => ({ [name]: value }));\n  }\n\n  handleChangeRadio(e,el) {\n    this.setState({ selectedRadio: el.id, showCategories:false }, async () => {\n      this.handleButton(e);\n    });\n  }\n  ordenaProducts = (products) => {\n    const {selectedFilter} = this.state;\n    let aux;\n    if(selectedFilter===\"Maior Preço\"){\n      aux=-1;\n    }else if(selectedFilter===\"Menor Preço\"){\n      aux=1;\n    }else{\n      return products;\n    }\n    const filtered = products.sort((a,b)=> {\n      if (a.price<b.price) {\n        return -1*aux;\n      }\n      if (a.price>b.price) {\n        return 1*aux;\n      }\n      return 0;\n    })\n    return filtered\n  }\n\n  handleButton = async (e) => {\n    e.preventDefault();\n    this.setState({APIAwait:false})\n    const { inputValue, selectedRadio } = this.state;\n    if (inputValue !== '' || selectedRadio !== '') {\n      const productsByNameAndCategory = await\n      getProductsByNameAndCategory(selectedRadio, inputValue);\n      const ordenProducts = this.ordenaProducts(productsByNameAndCategory)\n      this.setState({ filteredProducts: ordenProducts, APIAwait:true });\n    }\n  }\n\n  async setCategories() {\n    /* console.log(await getProductsByNameAndCategory('Agro', '')); */\n    const categories = (await getCategories());\n    this.setState({ listCategories: categories });\n  }\n\n  filterChange = (e) => {\n    const {target:{value}} = e\n    this.setState({selectedFilter:value})\n    this.handleButton(e)\n  }\n\n  addToCart = (product) => {\n    const { cartProducts } = this.state;\n    if (cartProducts.find((el) => el.id === product.id) === undefined) {\n      product.tamanho = 1;\n      this.setState({ cartProducts: [...cartProducts, product] }, () => {\n        const { cartProducts: Carrinho } = this.state;\n        localStorage.setItem('productCart', JSON.stringify(Carrinho));\n      });\n    } else {\n      let index;\n      [...cartProducts].find((el, i) => {\n        if (el.id === product.id) {\n          index = i;\n          return true;\n        }\n        return false;\n      });\n\n      cartProducts[index].tamanho += 1;\n      this.setState({ cartProducts }, () => {\n        const { cartProducts: Carrinho } = this.state;\n        localStorage.setItem('productCart', JSON.stringify(Carrinho));\n      });\n      if (product.available_quantity === product.tamanho - 1) {\n        product.tamanho = product.available_quantity;\n      }\n    }\n\n    this.setState((state) => {\n      const { cartProducts: cartAtualizado } = state;\n      const total = cartAtualizado.reduce((ant, at) => ant + at.tamanho, 0);\n      return { totalCart: total };\n    });\n  }\n\n  render() {\n    const { inputValue, listProducts, listCategories, selectedRadio,\n      filteredProducts, totalCart, APIAwait, selectedFilter, showCategories  } = this.state;\n    const { history } = this.props;\n    const validListProducts = (listProducts.length === 0);\n    return (\n      <div className='home'>\n        <Header history={history}/>\n        <form onSubmit={this.handleButton}>\n        <input\n          name=\"inputValue\"\n          type=\"text\"\n          value={ inputValue }\n          onChange={ this.handleChange }\n          data-testid=\"query-input\"\n          autocomplete='off'\n        />\n        <button\n          type=\"submmit\"\n          data-testid=\"query-button\"\n        >\n          Buscar\n        </button>\n        </form>\n\n        <select onChange={ (e)=>this.filterChange(e)} value={selectedFilter}>\n          <option hidden >Ordenar por Preço</option>\n          <option>Maior Preço</option>\n          <option>Menor Preço</option>\n        </select>\n\n\n        {validListProducts && (\n          <p data-testid=\"home-initial-message\">\n            Digite algum termo de pesquisa ou escolha uma categoria.\n          </p>)}\n        <button\n          type=\"button\"\n          data-testid=\"shopping-cart-button\"\n          onClick={ () => history.push('/cart') }\n        >\n          Carrinho\n        </button>\n        <div>\n          {showCategories?\n          <ModalCategories \n          listCategories={listCategories} \n          selectedRadio={selectedRadio} \n          handleChangeRadio={this.handleChangeRadio}\n          showCategories={()=>this.setState({showCategories:false})}/>:\n          <p onClick={()=>this.setState({showCategories:false})}>Categorias</p>\n        }\n        </div>\n        <div>\n          {APIAwait && filteredProducts.map((cada) => (\n            <div\n              data-testid=\"product\"\n              key={ cada.title }\n            >\n              {cada.shipping.free_shipping && (\n                <p data-testid=\"free-shipping\">Frete Grátis</p>)}\n              <p>{cada.title}</p>\n              <p>{\"R$ \"+cada.price}</p>\n              <div>\n                <img src={cada.thumbnail} alt={cada.title}/>\n              </div>\n              <button\n                type=\"button\"\n                onClick={ () => history.push({ pathname: `/product/${cada.id}`,\n                  state: (cada) }) }\n                data-testid=\"product-detail-link\"\n              >\n                Detalhes\n              </button>\n              <button\n                type=\"button\"\n                onClick={ () => this.addToCart(cada) }\n                data-testid=\"product-add-to-cart\"\n              >\n                Adicionar ao Carrinho\n              </button>\n            </div>\n          ))}\n          <h2 data-testid=\"shopping-cart-size\">{totalCart}</h2>\n        </div>\n      </div>\n    );\n  }\n}\nHome.propTypes = {\n  history: PropTypes.instanceOf(Object).isRequired,\n};\n\nexport default Home;\n"]},"metadata":{},"sourceType":"module"}